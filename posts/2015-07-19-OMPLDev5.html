<link rel="stylesheet" href="../style.css">

<div class="sidebar">
     <a href="/index.html">home</a>
     <br>
     <a href="/about.html">about</a>
     <br>
     <a href="/blog.html">blog</a>
     <br>
     <br>
     <a href="https://www.github.com/prb2">github</a>
</div>

<h1 id="ompl-web-development---part-5">OMPL Web Development - Part
5</h1>
<p><strong>2015-07-19</strong></p>
<hr />
<!-- TODO: use pandoc html template using the meta syntact for title and date and
then have it insert into the page with a <hr> after -->
<p>Benchmarking planners is a time consuming process, so instead of
waiting on the web page to see the results, users submit jobs and are
notified when the results become available. This process is handled by
<a href="http://www.celeryproject.org">Celery</a>, an asynchronous task
queue implemented in Python. When a benchmarking job is submitted, it is
given to a Celery worker to execute, freeing up the Flask server to
continue to serve other requests. Using Celery for benchmarking was
fairly simple to setup since the client doesn't need any information
from the completed job.</p>
<p><img src="" class="img-responsive"></p>
<p>However, solving a motion planning problem can also take a large
amount of time; solving them synchronously would be impractical.</p>
<div class="subtitle">
Asynchronous Solving
</div>
<p>The problem with making regular motion planning asynchronous is that
the user waits for the solution. For asynchronous solving to work, there
must be some amount of coordination between the client and server to
ensure that the right results are returned to the right user.</p>
<p><img src="../images/omplweb/async_solving.png" class="img-responsive"></p>
<p>To solve this problem, I came up with the pattern seen above. When
the user submits a motion planning problem, the task is assigned to a
Celery worker and the ID of that task is immediately returned to the
client. Then, the client will periodically poll the server for the
results.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/omplapp/poll/&lt;task_id&gt;&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> poll(task_id):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Checks if the task corresponding to the input ID has completed. If the</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    task is done solving, the solution is returned.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> solve.AsyncResult(task_id)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.ready():</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json.dumps(result.get()), <span class="dv">200</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> :</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;Result for task id: &quot;</span> <span class="op">+</span> task_id <span class="op">+</span> <span class="st">&quot; isn&#39;t ready yet.&quot;</span>, <span class="dv">202</span></span></code></pre></div>
