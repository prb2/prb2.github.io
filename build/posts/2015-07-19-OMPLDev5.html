<div class="sidebar">
  <svg class="square" viewBox="0 0 2 2" xmlns="http://www.w3.org/2000/svg">
    <polygon stroke="white" stroke-width=0.02 points="0,0  1,0  0,1" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,0  1,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  1,1  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  2,1  2,0" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  0,2  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,1  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="1,1  1,2  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,2  2,1  2,2" />
  </svg>
  <!-- <svg class="square" viewBox="0 0 2 2" xmlns="http://www.w3.org/2000/svg">
    <polygon stroke="white" stroke-width=0.02 points="0,0  1,0  0,1" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,0  1,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  1,1  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  2,1  2,0" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  0,2  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,1  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="1,1  1,2  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,2  2,1  2,2" />
  </svg>
  <br>
  <svg class="square" viewBox="0 0 2 2" xmlns="http://www.w3.org/2000/svg">
    <polygon stroke="white" stroke-width=0.02 points="0,0  1,0  0,1" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,0  1,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  1,1  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  2,1  2,0" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  0,2  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,1  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="1,1  1,2  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,2  2,1  2,2" />
  </svg>
  <svg class="square" viewBox="0 0 2 2" xmlns="http://www.w3.org/2000/svg">
    <polygon stroke="white" stroke-width=0.02 points="0,0  1,0  0,1" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,0  1,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  1,1  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,0  2,1  2,0" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  0,2  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="0,1  1,1  1,2" />
    <polygon stroke="white" stroke-width=0.02 points="1,1  1,2  2,1" />
    <polygon stroke="white" stroke-width=0.02 points="1,2  2,1  2,2" />
  </svg> -->
  <style>
    .square {
      height: 128px;
      width: 128px;
      /* margin-right: 2px; */
    }
  </style>
  <script>
    function getRandomNum(max) {
      return Math.floor(Math.random() * max);
    }
    function getRandomColor(colors) {
      return colors[getRandomNum(colors.length)]
    }
    colorSets = [
      ["#021526", "#03346E", "#6EACDA", "#E2E2B6"],
      ["#DEF9C4", "#9CDBA6", "#50B498", "#468585"],
      ["#F9ED69", "#F08A5D", "#B83B5E", "#6A2C70"],
      ["#3D30A2", "#EB5B00", "#E4003A", "#B60071"],
    ]
    for (s of document.getElementsByTagName("svg")) {
      // pick a colorSet randomly for the polygon stroke="white" stroke-width=0.02s in this square
      colors = colorSets[getRandomNum(colorSets.length)]
      console.log("picked colors", colors)
      lastColor = colors[0]
      for (p of s.children) {
        if (Math.random() < 0.4) {
          // reuse the last color
        } else {
          // pick a random color from the colorSet
          lastColor = getRandomColor(colors)
        }
        p.setAttribute("fill", lastColor)
      }
    }

    // window.addEventListener('resize', function (event) {
    //   side_len = document.getElementsByClassName("sidebar")[0].offsetWidth - 120
    //   document.getElementsByClassName("square")[0].style.width = side_len + "px"
    //   document.getElementsByClassName("square")[0].style.height = side_len + "px"
    // }, true);
  </script>
  <br><br><br>
  <a href="/index.html">home</a>
  <br>
  <a href="/blog.html">blog</a>
  <br>
  <a href="/projects.html">projects</a>
  <br>
  <br>
  <a href="https://www.github.com/prb2">github</a>
</div><!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2015-07-19" />
  <title>OMPL Web Development - Part 5</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">OMPL Web Development - Part 5</h1>
<p class="date">2015-07-19</p>
</header>
<hr />
<p>Benchmarking planners is a time consuming process, so instead of
waiting on the web page to see the results, users submit jobs and are
notified when the results become available. This process is handled by
<a href="http://www.celeryproject.org">Celery</a>, an asynchronous task
queue implemented in Python. When a benchmarking job is submitted, it is
given to a Celery worker to execute, freeing up the Flask server to
continue to serve other requests. Using Celery for benchmarking was
fairly simple to setup since the client doesn't need any information
from the completed job.</p>
<p><img src="" class="img-responsive"></p>
<p>However, solving a motion planning problem can also take a large
amount of time; solving them synchronously would be impractical.</p>
<h2 id="asynchronous-solving">Asynchronous Solving</h2>
<p>The problem with making regular motion planning asynchronous is that
the user waits for the solution. For asynchronous solving to work, there
must be some amount of coordination between the client and server to
ensure that the right results are returned to the right user.</p>
<p><img src="../images/omplweb/async_solving.png" class="img-responsive"></p>
<p>To solve this problem, I came up with the pattern seen above. When
the user submits a motion planning problem, the task is assigned to a
Celery worker and the ID of that task is immediately returned to the
client. Then, the client will periodically poll the server for the
results.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/omplapp/poll/&lt;task_id&gt;&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> poll(task_id):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Checks if the task corresponding to the input ID has completed. If the</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    task is done solving, the solution is returned.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> solve.AsyncResult(task_id)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.ready():</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json.dumps(result.get()), <span class="dv">200</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> :</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;Result for task id: &quot;</span> <span class="op">+</span> task_id <span class="op">+</span> <span class="st">&quot; isn&#39;t ready yet.&quot;</span>, <span class="dv">202</span></span></code></pre></div>
</body>
</html>
